VALIDATION-RULESET-NAME PDS Configuration Ruleset
VALIDATION-RULESET-VERSION 4.11
VALIDATION-RULESET-TIMESTAMP 20150105
VALIDATION-RULESET-AUTHOR Richard Robinson (rrobinson@hscic.gov.uk)

# Validate against the Spine 2 generic ruleset
INCLUDE /home/riro/TKW-5.0.5/TKW/config/SPINE_Generic_Validation/validator_config/ITK_Config_Generic_Spine2.conf

			VALIDATE QUPA_IN000005UK03
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[@nullFlavor='NA']
			ANNOTATION This checks that within a simple Query the BirthTime does not contain null flavor. <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.deceasedTime
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[not(@value < /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.deceasedTime/hl7:value/@value)]/@value
			ANNOTATION This checks that within a simple Query the DeceasedTime does not precede the birthTime. <br/>
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address[not(hl7:person.address)]
			THEN
			ELSE
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[hl7:postalCode or hl7:addressKey]
			ANNOTATION <b>Purpose:</b><br/> This checks that within the parameter Person.address for either postcode or addressKey. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN000014UK03
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[@nullFlavor='NA']
			ANNOTATION This checks that within a simple Query the BirthTime does not contain null flavor. <br/>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN000006UK05
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:searchParameter/hl7:value[@codeSystem='2.16.840.1.113883.2.1.3.2.4.17.39'][@code='1']
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:family,'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:family,"*"))>= 2)]/hl7:person.name/hl7:value/hl7:family
			ANNOTATION This checks that within advanced trace when the Patient Name or Family Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:given[1],'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:given[1],"*"))>= 2)]/hl7:person.name/hl7:value/hl7:given[1]
			ANNOTATION This checks that within advanced trace when the First Patient Given Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:given[2],'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:given[2],"*"))>= 2)]/hl7:person.name/hl7:value/hl7:given[2]
			ANNOTATION This checks that within advanced trace when the Second Patient Given Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[contains(hl7:postalCode,'*')and not(string-length(substring-before(hl7:postalCode,"*"))>= 2)]/hl7:postalCode
			ANNOTATION This checks that within advanced trace when the PostCode search uses a wildcard it is preceded by two characters. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[string-length(hl7:low/@value)>8 or string-length(hl7:high/@value)>8 or string-length(hl7:center/@value)>8]//@value
			ANNOTATION This checks that there are no HH hours MM Minutes and SS Seconds provided along with a Date. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-9.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[hl7:center/@value and hl7:low/@value or hl7:high/@value and hl7:center/@value or  hl7:high/@value and not(hl7:low/@value) or hl7:low/@value and not(hl7:high/@value)]/*
			ANNOTATION This checks that there is either a high and low sub element of BirthTime or center. <br/> MIM 3.1.11 and 4.2.00 Datatypes Interval (IVL) Time stamp (TS)
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id
			ANNOTATION This checks that within the Advance Trace the parameter Person.ID is not present. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-2
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN000008UK05
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id/hl7:value[@root='2.16.840.1.113883.2.1.4.1' or @root='2.16.840.1.113883.2.1.3.2.4.3']/@root
			ANNOTATION This checks that within the Retrieval Query the parameter Person.ID OID is either "2.16.840.1.113883.2.1.4.1" or "2.16.840.1.113883.2.1.3.2.4.3". <br/>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id/hl7:value[@root='2.16.840.1.113883.2.1.4.1' and string-length(@extension)=10 or @root='2.16.840.1.113883.2.1.3.2.4.3']/@extension
			ANNOTATION This checks that within the Retrieval Query if the parameter Person.ID OID is "2.16.840.1.113883.2.1.4.1" the attribute extension contains a value with 10 digits or 2.16.840.1.113883.2.1.3.2.4.3 with the corresponding Temporary NHS number issued by an NHAIS registration authority or the old NHS number itself. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDVLD-1.1
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN000200UK04
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Address_Validation.xslt Error
			ANNOTATION <b>Purpose:</b><br/> Address lines 1-5 MUST NOT exceed 35 characters <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <br/> <li>PDS Create Initial Record Request (Patient.addr)</li> <br/> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress . PartOfWhole.addr)</li> <br/> <li>PDS Birth Notification (Patient.addr/)</li> <br/> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-4.1</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[hl7:addr][local-name()='patientRole' or 'scopedRelatedPersonRole' or 'patient']/hl7:addr[@use='PST' and not(hl7:useablePeriod)]
			ANNOTATION <b>Purpose:</b><br/> Check the business effective dates associated with correspondence addresses MUST be recorded. <ul> <li>only applies to addresses with use ='PST'</li> <li>the useablePeriod must be present and populated.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request - (PatientRole.addr)]</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03; UPDSPT-6.1.3</li> <li>(Note, this requirement is not described in the MIM or DIM)</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr[hl7:useablePeriod]
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:low/@value]/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.low.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationRequest/hl7:subject/hl7:patientRole/hl7:subjectOf4/hl7:sharedSecret
			ANNOTATION This is to to check that the allocation does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole' or local-name()='patient']/hl7:telecom[@use]/*
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/telecom[not(@use='HP') and not(@use='H') and not(@use='MC') and not(@use='HV') and not(@use='WP') and not(@use='AS') and not(@use='EC') and not(@use='PG') and not(@use='MC')]/@use
				
			ANNOTATION To enforce the particular flavour of the Telecommunication Address (TEL) datatype used here is Telecommunication address plus use. <ul> For each telecommunication number, the use attribute to denote the type of telecommunication address must occur (mandatory). The use attribute can take the following values: <li>H - A communication address at a home;</li> <li>HP - The primary home, to reach a person after business hours;</li> <li>HV - A vacation home, to reach a person while on vacation; <li>WP - An office address;</li> <li>AS - An automated answering machine;</li> <li>EC - A contact specifically designated to be used for emergencies;</li> <li>PG - A paging device suitable to solicit a callback or to leave a very short message;</li> <li>MC - A telecommunication device that moves and stays with its owner.</li></li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-8</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[@use='L']/@use
			THEN
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[not(count(hl7:family)=1)]
			ANNOTATION This checks that within PDS Allocate NHS Number Request a single instance of the family element is used to carry the family name (or surname); <br/> REF TO MIM 3.1.07 onwards: Tabular View Person.name
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[not(count(hl7:given)>0)]
			ANNOTATION This checks that within PDS Allocate NHS Number Request One or more instances of the given element are used to carry given names (or forenames) or initials. <br/> REF TO MIM 3.1.07 onwards: Tabular View Person.name
			ENDIF
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='addr'][parent::hl7:patientRole][@use='H' or @use='TMP']
			ANNOTATION <b>Purpose:</b><br/> This checks that as a minimum, the PDS NHS Number Allocation Request message MUST contain the following mandatory field: A current UK address of type H or TMP <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request - (PatientRole.addr)</li> <br/><li> </li></ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03 UPDALT-9</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole' or local-name()='patient' or local-name()='scopedRelatedPersonRole']/hl7:addr[string-length(hl7:streetAddressLine[1])=0 and string-length(hl7:streetAddressLine[2])=0 or string-length(hl7:streetAddressLine[4])=0]/*
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: One and five streetAddressLine elements are used. Lines 1 or 2 and line 4 MUST be populated <br/> Where:<ul> <li>line 1: premises ID</li> <li>line 2: no/thoroughfare</li> <li>line 4: post town</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <li>PDS Create Initial Record Request (Patient.addr)</li> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress (PartOfWhole.addr)</li> <li>PDS Birth Notification (Patient.addr)</li> <br/><li> </li></ul> <b>Requirement Reference:</b> <ul> <li>From MIM 6.2.02, PDS –Version 4.3</li> <li> NPFIT-FNT-TO-DPM-0649.03: UPDADD-3.1,UPDADD-11.2</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN000205UK05
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Address_Validation.xslt Error
			ANNOTATION <b>Purpose:</b><br/> Address lines 1-5 MUST NOT exceed 35 characters <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <br/> <li>PDS Create Initial Record Request (Patient.addr)</li> <br/> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress . PartOfWhole.addr)</li> <br/> <li>PDS Birth Notification (Patient.addr/)</li> <br/> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-4.1</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='addr'][parent::hl7:patient][@use='H' or @use='TMP']/@use
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The use attribute to denote the type of address.</li> <li>Only the values "H" (Home address)</li> <li>and "TMP" (Temporary address) are permitted here (mandatory).</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS Create Initial Record Request - (Patient.addr)</li> <br/> <li>PDS Birth Notification - (Patient.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>2008-A PDS Compliance Baseline: Updates, Version 2.0 NPFIT-FNT-TO-DPM-0649.03</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[string-length(hl7:streetAddressLine[1])=0 and string-length(hl7:streetAddressLine[2])=0 or string-length(hl7:streetAddressLine[4])=0]/*
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.patient.addr conforms to the following constraint that for the addr.streetAddressLine line 1 or line 2 and line 4 must be populated. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>addr.streetAddressLine</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[@use='H']/@use
			ANNOTATION This checks that the patient.addr conforms to the following constraint that one of the addr.use must be populated with 'H'. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[not(@use='H') and not(@use='TMP')]/@use
			ANNOTATION This checks that the patient.addr conforms to the following constraint that the addr.use must be populated only with 'TMP' or 'H'. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name[count(hl7:family)>1]
			ANNOTATION <b>Purpose:</b><br/> This checks that the patientPerson.name does not have more than one family name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>patientPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name[count(hl7:given)>2]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name does not contain more than two given name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name/child::hl7:family[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name.family does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name/child::hl7:given[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name.given does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name[not(@use='L')]/@use
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name attribute use only contains "L". <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.name.use</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf1/hl7:birthWeight/hl7:value/@value ^\d{4}$
			ANNOTATION <b>Purpose:</b><br/> This checks that the patient.birthWeight value must be 4 digits between 0-9, in order to be accepted by NN4B. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patient.birthWeight</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component4/hl7:gestationAge/hl7:value[string-length(@value)=0]
			ANNOTATION This checks that the patient.gestationWeight value must be populated, <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patient.birthWeight</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component4/hl7:gestationAge/hl7:value/@value ^([0-4][0-9]|[0][0]|[9][9])$
			ANNOTATION <b>Purpose:</b><br/> This checks that the clinicalInformation.component4.gestationAge.value value must be 2 digits the first being between 1-4, inclusive of 4, the second digit should be between 0-9 inclusive of 9 and also including values 00 and 99. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>clinicalInformation.component4.gestationAge.value</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:subjectOf/hl7:primaryCareProvision/hl7:performer/hl7:primaryCareProvider/hl7:id[not(string-length(@extension)=6)]/@extension
			ANNOTATION This checks that the primaryCareProvider.id.extension must be populated, with a value which has a length of 6. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>primaryCareProvider.id.extension</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson[string-length(hl7:birthTime/@value)=8 or string-length(hl7:birthTime/@value)=12 or string-length(hl7:COCT_MT000210UK01.PartBirthTime/hl7:partPerson/hl7:birthTime/@value)=8 or string-length(hl7:COCT_MT000210UK01.PartBirthTime/hl7:partPerson/hl7:birthTime/@value)=12]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest BirthTime has a length of at least 8 and no more than 12. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.birthTime</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson[not(string-length(hl7:birthTime/@value)>=8)]/hl7:birthTime/@value
			ANNOTATION This checks that the PDSCreateInitialRecordRequest and the PdsBirthNotification patientMotherPerson.birthTime contains a value which has a length of 8 or more. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.birthTime</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[count(hl7:family)>1]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name does not have more than one family name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[count(hl7:given)>2]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name does not contain more than two given name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name/child::hl7:family[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.family does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientMotherPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name/child::hl7:given[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.given does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:id/@extension [0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]
			ANNOTATION This checks that within the mother nhs number contains 10 digits which are between 0-9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>mother.id</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[string-length(hl7:family)=0]/hl7:family
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.family contains a value. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[string-length(hl7:given[1])=0]/hl7:given[1]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.given contains a value. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:multipleBirthOrderNumber/@value ^([1-9])$
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.patientPerson.multipleBirthOrderNumber contains a value which is a single digit between 1-9 and inclusive of 9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.multipleBirthOrderNumber</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			IF hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value ^([1-6]|[9])$
			THEN
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient[hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value<6]/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value[@value < /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:multipleBirthOrderNumber/@value]/@value
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest.NumberOfFoetusConfinement value is more or equal to the patientPerson.multipleBirthOrderNumber. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.multipleBirthOrderNumber</li> <li>numberOfFoetusInConfinement</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient[hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value<6]/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value[@value < /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:multipleBirthOrderNumber/@value]/@value
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest.NumberOfFoetusConfinement value is more or equal to the patientPerson.multipleBirthOrderNumber. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.multipleBirthOrderNumber</li> <li>numberOfFoetusInConfinement</li> </ul>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(hl7:family)=0]/hl7:family
			ANNOTATION This checks that within the notifying person the name.family is populated. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[count(child::hl7:family)>1]/hl7:family
			ANNOTATION <b>Purpose:</b><br/> This checks that within the notifying person there is only one name.family present. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[count(child::hl7:given)>2]/hl7:given
			ANNOTATION This checks that within the notifying person no more than two name.given are present. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(hl7:given[1])=0 or string-length(hl7:given[2])>0]/hl7:given
			ANNOTATION 
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(child::hl7:family)>35]/hl7:family
			ANNOTATION This checks that within the notifying person the name.family is no more than 35 characters in length. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathexists /*[1]//hl7:subject/hl7:patient[hl7:patientPerson/hl7:COCT_MT000208UK01.BirthPlace/hl7:addr/hl7:country or hl7:patientPerson/hl7:COCT_MT000208UK01.BirthPlace/hl7:addr/hl7:city or hl7:patientPerson/hl7:COCT_MT000208UK01.BirthPlace/hl7:addr/hl7:county]/child::*
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.locatedPlaceOfBirth.addr contains the patient country,county or city. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>locatedPlaceOfBirth.addr</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:location/hl7:participantDeliveryLocation/hl7:code[@code=0 or @code=2 or @code=3 or @code=4 or @code=7]/@code
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest.participantDeliveryLocation.code does not contain the values 0 or 2, 3, 4 or 7. <br/> REF TO MIM 7.2.02 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>participantDeliveryLocation,code</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:location/hl7:participantIdentifiedDeliveryLocation/hl7:code[@code=1 or @code=8 or @code=9]/@code
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.participantIdentifiedDeliveryLocation.code does not contain the values 1,8 or 9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>participantIdentifiedDeliveryLocation,codee</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patient[not(string-length(hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:locatedPlaceOfBirth/hl7:name)>0) and not((hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:code/@code)='1')and not(hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:code/@code='8') and not(hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:code/@code='9') ]/hl7:code/@code
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.locatedPlaceOfBirth.name exist if the participantIdentifiedDeliveryLocation exists. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>locatedPlaceOfBirth.name</li> <li>participantIdentifiedDeliveryLocation.code </li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole' or local-name()='patient']/hl7:telecom[@use]/*
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/telecom[not(@use='HP') and not(@use='H') and not(@use='MC') and not(@use='HV') and not(@use='WP') and not(@use='AS') and not(@use='EC') and not(@use='PG') and not(@use='MC')]/@use
				
			ANNOTATION To enforce the particular flavour of the Telecommunication Address (TEL) datatype used here is Telecommunication address plus use. <ul> For each telecommunication number, the use attribute to denote the type of telecommunication address must occur (mandatory). The use attribute can take the following values: <li>H - A communication address at a home;</li> <li>HP - The primary home, to reach a person after business hours;</li> <li>HV - A vacation home, to reach a person while on vacation; <li>WP - An office address;</li> <li>AS - An automated answering machine;</li> <li>EC - A contact specifically designated to be used for emergencies;</li> <li>PG - A paging device suitable to solicit a callback or to leave a very short message;</li> <li>MC - A telecommunication device that moves and stays with its owner.</li></li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-8</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN000208UK03
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Address_Validation.xslt Error
			ANNOTATION <b>Purpose:</b><br/> Address lines 1-5 MUST NOT exceed 35 characters <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <br/> <li>PDS Create Initial Record Request (Patient.addr)</li> <br/> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress . PartOfWhole.addr)</li> <br/> <li>PDS Birth Notification (Patient.addr/)</li> <br/> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-4.1</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='addr'][parent::hl7:patient][@use='H' or @use='TMP']/@use
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The use attribute to denote the type of address.</li> <li>Only the values "H" (Home address)</li> <li>and "TMP" (Temporary address) are permitted here (mandatory).</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS Create Initial Record Request - (Patient.addr)</li> <br/> <li>PDS Birth Notification - (Patient.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>2008-A PDS Compliance Baseline: Updates, Version 2.0 NPFIT-FNT-TO-DPM-0649.03</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[string-length(hl7:streetAddressLine[1])=0 and string-length(hl7:streetAddressLine[2])=0 or string-length(hl7:streetAddressLine[4])=0]/*
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.patient.addr conforms to the following constraint that for the addr.streetAddressLine line 1 or line 2 and line 4 must be populated. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>addr.streetAddressLine</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[@use='H']/@use
			ANNOTATION This checks that the patient.addr conforms to the following constraint that one of the addr.use must be populated with 'H'. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[not(@use='H') and not(@use='TMP')]/@use
			ANNOTATION This checks that the patient.addr conforms to the following constraint that the addr.use must be populated only with 'TMP' or 'H'. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name/child::hl7:family[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name.family does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name/child::hl7:given[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name.given does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientPerson.name.given</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf1/hl7:birthWeight/hl7:value/@value ^\d{4}$
			ANNOTATION <b>Purpose:</b><br/> This checks that the patient.birthWeight value must be 4 digits between 0-9, in order to be accepted by NN4B. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patient.birthWeight</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component4/hl7:gestationAge/hl7:value[string-length(@value)=0]
			ANNOTATION This checks that the patient.gestationWeight value must be populated, <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patient.birthWeight</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component4/hl7:gestationAge/hl7:value/@value ^([0-4][0-9]|[0][0]|[9][9])$
			ANNOTATION <b>Purpose:</b><br/> This checks that the clinicalInformation.component4.gestationAge.value value must be 2 digits the first being between 1-4, inclusive of 4, the second digit should be between 0-9 inclusive of 9 and also including values 00 and 99. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>clinicalInformation.component4.gestationAge.value</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:subjectOf/hl7:primaryCareProvision/hl7:performer/hl7:primaryCareProvider/hl7:id[not(string-length(@extension)=6)]/@extension
			ANNOTATION This checks that the primaryCareProvider.id.extension must be populated, with a value which has a length of 6. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>primaryCareProvider.id.extension</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[count(hl7:family)>1]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name does not have more than one family name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[count(hl7:given)>2]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name does not contain more than two given name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother[string-length(hl7:id/@extension)=0 and string-length(hl7:patientMotherPerson/hl7:birthTime/@value)=0]
			ANNOTATION This checks that the PDSBirthNotification mother.id or patientMotherPerson.birthTime are not null in order to be accepted by NN4B. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. <ul><li>patientMotherPerson.birthTime </li> <li>mother.id</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[string-length(hl7:family)=0]/hl7:family
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.family contains a value. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[string-length(hl7:given[1])=0]/hl7:given[1]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.given contains a value. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name/child::hl7:family[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.family does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientMotherPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name/child::hl7:given[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.given does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:multipleBirthOrderNumber/@value ^([1-9])$
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.patientPerson.multipleBirthOrderNumber contains a value which is a single digit between 1-9 and inclusive of 9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.multipleBirthOrderNumber</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value[@value < /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:multipleBirthOrderNumber/@value]/@value
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest.NumberOfFoetusConfinement value is more or equal to the patientPerson.multipleBirthOrderNumber. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.multipleBirthOrderNumber</li> <li>numberOfFoetusInConfinement</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value ^([1-6]|[9])$
			ANNOTATION This checks that the patient.numberOfFoetusConfinement value must be 1 digit ranging from 1-6, including 6 and 9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patient.numberOfFoetusConfinement</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(hl7:family)=0]/hl7:family
			ANNOTATION This checks that within the notifying person the name.family is populated. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[count(child::hl7:family)>1]/hl7:family
			ANNOTATION <b>Purpose:</b><br/> This checks that within the notifying person there is only one name.family present. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[count(child::hl7:given)>2]/hl7:given
			ANNOTATION This checks that within the notifying person no more than two name.given are present. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(hl7:given[1])=0 or string-length(hl7:given[2])>0]/hl7:given
			ANNOTATION 
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(child::hl7:family)>35]/hl7:family
			ANNOTATION This checks that within the notifying person the name.family is no more than 35 characters in length. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathexists /*[1]//hl7:subject/hl7:patient[hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:locatedPlaceOfBirth/hl7:addr/hl7:country or hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*//hl7:locatedPlaceOfBirth/hl7:addr/hl7:city or hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*//hl7:locatedPlaceOfBirth/hl7:addr/hl7:county]/child::*
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.locatedPlaceOfBirth.addr contains the patient country,county or city. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>locatedPlaceOfBirth.addr</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:location/hl7:participantDeliveryLocation/hl7:code[@code=0 or @code=2 or @code=3 or @code=4 or @code=7]/@code
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest.participantDeliveryLocation.code does not contain the values 0 or 2, 3, 4 or 7. <br/> REF TO MIM 7.2.02 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>participantDeliveryLocation,code</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:location/hl7:participantIdentifiedDeliveryLocation/hl7:code[@code=1 or @code=8 or @code=9]/@code
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.participantIdentifiedDeliveryLocation.code does not contain the values 1,8 or 9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>participantIdentifiedDeliveryLocation,codee</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patient']/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:subjectOf/hl7:primaryCareProvision/hl7:performer/hl7:primaryCareProviderWithDetail/hl7:healthCarePrimaryCarePractice/hl7:addr[not(count(hl7:streetAddressLine) < 6) or not(count(hl7:streetAddressLine)> 0) or string-length(hl7:streetAddressLine[1])=0 and string-length(hl7:streetAddressLine[2])=0]/*
			ANNOTATION <b>Purpose:</b><br/> The Address streetAddressLine needs structure is checked for: <ul> <li>a minimum of one and a maximum of five streetAddressLine elements.</li> <li>either Address Line 1 or Address Line 2 must be present.</li> </ul> <b>Applied to Messages:</b> <ul> <li> PDS Birth Notification - (PrimaryCarePractice.addr/)]</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>2008-A PDS Compliance Baseline: Updates, Version 2.0 NPFIT-FNT-TO-DPM-0649.03</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN000203UK06
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Address_Validation.xslt Error
			ANNOTATION <b>Purpose:</b><br/> Address lines 1-5 MUST NOT exceed 35 characters <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <br/> <li>PDS Create Initial Record Request (Patient.addr)</li> <br/> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress . PartOfWhole.addr)</li> <br/> <li>PDS Birth Notification (Patient.addr/)</li> <br/> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-4.1</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[hl7:addr][local-name()='patientRole' or 'scopedRelatedPersonRole' or 'patient']/hl7:addr[@use='PST' and not(@updateMode='removed') and not(hl7:useablePeriod)]
			ANNOTATION <b>Purpose:</b><br/> Check the business effective dates associated with correspondence addresses MUST be recorded. <ul> <li>only applies to addresses with use ='PST'</li> <li>the useablePeriod must be present and populated.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS General Update Request - (PatientRole.addr/ RelatedPersonRole.addr)]</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03; UPDSPT-6.1.3</li> <li>(Note, this requirement is not described in the MIM or DIM)</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[contains(local-name(),'patientRole') or contains(local-name(),'patient')]/hl7:addr[@use='H'][@updateMode='added' or @updateMode='altered'][hl7:useablePeriod]/hl7:useablePeriod/@high
			ANNOTATION <b>Purpose:</b><br/> The following objects MUST NOT be assigned a business effective to date when added or altered on the PDS: Patient home address (use = H) <br/> <b>Applied to Messages:</b> <ul> <li>PDS General Update Request -(PatientRole.addr/ RelatedPersonRole.addr)])</li> <br/> <li>PDS NHAIS Update Request - (PatientRole.addr)] </li> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-2 (Note this is not stated in the MIM 6.2.02 or in the DIM Issue 7)</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr[hl7:useablePeriod]
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:low/@value]/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.low.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[@updateMode]/@updateMode
			THEN
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_GeneralUpdateValidation_AllInOne.xslt Error
			ANNOTATION An element with updateMode = 'altered' or 'removed' or 'added' need to meet certain constraints depending on the element and the state of it. This runs additional 76 rules and returns the summary fo errors. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1][hl7:ControlActEvent//hl7:person.deceasedTime/hl7:value/@value | hl7:ControlActEvent//hl7:subject//hl7:subject/hl7:patientRole//hl7:deceasedTime/@value]
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]//hl7:subject/hl7:patientRole//hl7:deceasedTime[string-length(@value)!=12 and string-length(@value)!=8 and /*[1]//hl7:deathNotification[@updateMode="added" or @updateMode="altered"]]
				
			ANNOTATION This checks that when a deceasedTime is added or altered it is in the form of YYYYMMDD with a length of 8 or 12. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDSEM-4
			CHECK hl7_xpathnotexists /*[1]//hl7:deceasedTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the deceasedTime is not in the future based on if its value is more than the message creation date <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3 deceasedTime is not in the future when compared to message creation date.
			CHECK hl7_xpathexists /*[1]//hl7:deathNotification[@updateMode=/*[1]//hl7:deceasedTime/@updateMode or @updateMode=/*[1]//hl7:COCT_MT000211UK01.PartDeceasedTime/@updateMode]/@updateMode
				
			ANNOTATION This checks that the deathNotification attribute updateMode is equal to deceasedTime attribute updateMode. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDSEM-4.2
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:scopedRelatedPersonRole//hl7:partNextOfKin/hl7:code[@code!='1']/@code
			ANNOTATION <b>Purpose:</b><br/> This checks that within the PDS Update the related person <ul> <li>next of kin element is present only when NOK code = 1 </li> </ul> <b>Applied to Messages:</b> <ul> <li> PDS General Update message(patientPerson.scopedRelatedPersonRole.partNextOfKin.code)]</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 4.2 PDS – tabular view constraint </li> </ul> <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole' or local-name()='patient']/hl7:telecom[@use]/*
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/telecom[not(@use='HP') and not(@use='H') and not(@use='MC') and not(@use='HV') and not(@use='WP') and not(@use='AS') and not(@use='EC') and not(@use='PG') and not(@use='MC')]/@use
				
			ANNOTATION To enforce the particular flavour of the Telecommunication Address (TEL) datatype used here is Telecommunication address plus use. <ul> For each telecommunication number, the use attribute to denote the type of telecommunication address must occur (mandatory). The use attribute can take the following values: <li>H - A communication address at a home;</li> <li>HP - The primary home, to reach a person after business hours;</li> <li>HV - A vacation home, to reach a person while on vacation; <li>WP - An office address;</li> <li>AS - An automated answering machine;</li> <li>EC - A contact specifically designated to be used for emergencies;</li> <li>PG - A paging device suitable to solicit a callback or to leave a very short message;</li> <li>MC - A telecommunication device that moves and stays with its owner.</li></li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-8</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:subjectOf5/hl7:sharedSecret
			ANNOTATION This is to to check that the update does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:addr[not(@use='H')and not(@use='TMP') and not(@use='PST')]/@use
			ANNOTATION This checks that with a updated address that the following codes are used for the use attribute. H or TMP or PST. <br/> REF TO MIM 4.2 General update patient role address
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN000005UK01
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[@nullFlavor='NA']
			ANNOTATION This checks that within a simple Query the BirthTime does not contain null flavor. <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.deceasedTime
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[not(@value < /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.deceasedTime/hl7:value/@value)]/@value
			ANNOTATION This checks that within a simple Query the DeceasedTime does not precede the birthTime. <br/>
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address[not(hl7:person.address)]
			THEN
			ELSE
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[hl7:postalCode or hl7:addressKey]
			ANNOTATION <b>Purpose:</b><br/> This checks that within the parameter Person.address for either postcode or addressKey. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN000014UK01
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[@nullFlavor='NA']
			ANNOTATION This checks that within a simple Query the BirthTime does not contain null flavor. <br/>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN000006UK02
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:searchParameter/hl7:value[@codeSystem='2.16.840.1.113883.2.1.3.2.4.17.39'][@code='1']
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:family,'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:family,"*"))>= 2)]/hl7:person.name/hl7:value/hl7:family
			ANNOTATION This checks that within advanced trace when the Patient Name or Family Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:given[1],'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:given[1],"*"))>= 2)]/hl7:person.name/hl7:value/hl7:given[1]
			ANNOTATION This checks that within advanced trace when the First Patient Given Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:given[2],'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:given[2],"*"))>= 2)]/hl7:person.name/hl7:value/hl7:given[2]
			ANNOTATION This checks that within advanced trace when the Second Patient Given Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[contains(hl7:postalCode,'*')and not(string-length(substring-before(hl7:postalCode,"*"))>= 2)]/hl7:postalCode
			ANNOTATION This checks that within advanced trace when the PostCode search uses a wildcard it is preceded by two characters. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[string-length(hl7:low/@value)>8 or string-length(hl7:high/@value)>8 or string-length(hl7:center/@value)>8]//@value
			ANNOTATION This checks that there are no HH hours MM Minutes and SS Seconds provided along with a Date. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-9.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[hl7:center/@value and hl7:low/@value or hl7:high/@value and hl7:center/@value or  hl7:high/@value and not(hl7:low/@value) or hl7:low/@value and not(hl7:high/@value)]/*
			ANNOTATION This checks that there is either a high and low sub element of BirthTime or center. <br/> MIM 3.1.11 and 4.2.00 Datatypes Interval (IVL) Time stamp (TS)
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id
			ANNOTATION This checks that within the Advance Trace the parameter Person.ID is not present. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-2
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN000008UK02
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id/hl7:value[@root='2.16.840.1.113883.2.1.4.1' or @root='2.16.840.1.113883.2.1.3.2.4.3']/@root
			ANNOTATION This checks that within the Retrieval Query the parameter Person.ID OID is either "2.16.840.1.113883.2.1.4.1" or "2.16.840.1.113883.2.1.3.2.4.3". <br/>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id/hl7:value[@root='2.16.840.1.113883.2.1.4.1' and string-length(@extension)=10 or @root='2.16.840.1.113883.2.1.3.2.4.3']/@extension
			ANNOTATION This checks that within the Retrieval Query if the parameter Person.ID OID is "2.16.840.1.113883.2.1.4.1" the attribute extension contains a value with 10 digits or 2.16.840.1.113883.2.1.3.2.4.3 with the corresponding Temporary NHS number issued by an NHAIS registration authority or the old NHS number itself. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDVLD-1.1
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN000200UK03
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Address_Validation.xslt Error
			ANNOTATION <b>Purpose:</b><br/> Address lines 1-5 MUST NOT exceed 35 characters <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <br/> <li>PDS Create Initial Record Request (Patient.addr)</li> <br/> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress . PartOfWhole.addr)</li> <br/> <li>PDS Birth Notification (Patient.addr/)</li> <br/> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-4.1</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[hl7:addr][local-name()='patientRole' or 'scopedRelatedPersonRole' or 'patient']/hl7:addr[@use='PST' and not(hl7:useablePeriod)]
			ANNOTATION <b>Purpose:</b><br/> Check the business effective dates associated with correspondence addresses MUST be recorded. <ul> <li>only applies to addresses with use ='PST'</li> <li>the useablePeriod must be present and populated.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request - (PatientRole.addr)]</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03; UPDSPT-6.1.3</li> <li>(Note, this requirement is not described in the MIM or DIM)</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr[hl7:useablePeriod]
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:low/@value]/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.low.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationRequest/hl7:subject/hl7:patientRole/hl7:subjectOf4/hl7:sharedSecret
			ANNOTATION This is to to check that the allocation does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole' or local-name()='patient']/hl7:telecom[@use]/*
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/telecom[not(@use='HP') and not(@use='H') and not(@use='MC') and not(@use='HV') and not(@use='WP') and not(@use='AS') and not(@use='EC') and not(@use='PG') and not(@use='MC')]/@use
				
			ANNOTATION To enforce the particular flavour of the Telecommunication Address (TEL) datatype used here is Telecommunication address plus use. <ul> For each telecommunication number, the use attribute to denote the type of telecommunication address must occur (mandatory). The use attribute can take the following values: <li>H - A communication address at a home;</li> <li>HP - The primary home, to reach a person after business hours;</li> <li>HV - A vacation home, to reach a person while on vacation; <li>WP - An office address;</li> <li>AS - An automated answering machine;</li> <li>EC - A contact specifically designated to be used for emergencies;</li> <li>PG - A paging device suitable to solicit a callback or to leave a very short message;</li> <li>MC - A telecommunication device that moves and stays with its owner.</li></li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-8</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[@use='L']/@use
			THEN
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[not(count(hl7:family)=1)]
			ANNOTATION This checks that within PDS Allocate NHS Number Request a single instance of the family element is used to carry the family name (or surname); <br/> REF TO MIM 3.1.07 onwards: Tabular View Person.name
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[not(count(hl7:given)>0)]
			ANNOTATION This checks that within PDS Allocate NHS Number Request One or more instances of the given element are used to carry given names (or forenames) or initials. <br/> REF TO MIM 3.1.07 onwards: Tabular View Person.name
			ENDIF
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='addr'][parent::hl7:patientRole][@use='H' or @use='TMP']
			ANNOTATION <b>Purpose:</b><br/> This checks that as a minimum, the PDS NHS Number Allocation Request message MUST contain the following mandatory field: A current UK address of type H or TMP <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request - (PatientRole.addr)</li> <br/><li> </li></ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03 UPDALT-9</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole' or local-name()='patient' or local-name()='scopedRelatedPersonRole']/hl7:addr[string-length(hl7:streetAddressLine[1])=0 and string-length(hl7:streetAddressLine[2])=0 or string-length(hl7:streetAddressLine[4])=0]/*
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: One and five streetAddressLine elements are used. Lines 1 or 2 and line 4 MUST be populated <br/> Where:<ul> <li>line 1: premises ID</li> <li>line 2: no/thoroughfare</li> <li>line 4: post town</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <li>PDS Create Initial Record Request (Patient.addr)</li> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress (PartOfWhole.addr)</li> <li>PDS Birth Notification (Patient.addr)</li> <br/><li> </li></ul> <b>Requirement Reference:</b> <ul> <li>From MIM 6.2.02, PDS –Version 4.3</li> <li> NPFIT-FNT-TO-DPM-0649.03: UPDADD-3.1,UPDADD-11.2</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN000205UK03
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Address_Validation.xslt Error
			ANNOTATION <b>Purpose:</b><br/> Address lines 1-5 MUST NOT exceed 35 characters <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <br/> <li>PDS Create Initial Record Request (Patient.addr)</li> <br/> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress . PartOfWhole.addr)</li> <br/> <li>PDS Birth Notification (Patient.addr/)</li> <br/> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-4.1</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='addr'][parent::hl7:patient][@use='H' or @use='TMP']/@use
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The use attribute to denote the type of address.</li> <li>Only the values "H" (Home address)</li> <li>and "TMP" (Temporary address) are permitted here (mandatory).</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS Create Initial Record Request - (Patient.addr)</li> <br/> <li>PDS Birth Notification - (Patient.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>2008-A PDS Compliance Baseline: Updates, Version 2.0 NPFIT-FNT-TO-DPM-0649.03</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[string-length(hl7:streetAddressLine[1])=0 and string-length(hl7:streetAddressLine[2])=0 or string-length(hl7:streetAddressLine[4])=0]/*
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.patient.addr conforms to the following constraint that for the addr.streetAddressLine line 1 or line 2 and line 4 must be populated. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>addr.streetAddressLine</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[@use='H']/@use
			ANNOTATION This checks that the patient.addr conforms to the following constraint that one of the addr.use must be populated with 'H'. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:addr[not(@use='H') and not(@use='TMP')]/@use
			ANNOTATION This checks that the patient.addr conforms to the following constraint that the addr.use must be populated only with 'TMP' or 'H'. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name[count(hl7:family)>1]
			ANNOTATION <b>Purpose:</b><br/> This checks that the patientPerson.name does not have more than one family name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>patientPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name[count(hl7:given)>2]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name does not contain more than two given name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name/child::hl7:family[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name.family does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name/child::hl7:given[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name.given does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:name[not(@use='L')]/@use
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientPerson.name attribute use only contains "L". <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.name.use</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf1/hl7:birthWeight/hl7:value/@value ^\d{4}$
			ANNOTATION <b>Purpose:</b><br/> This checks that the patient.birthWeight value must be 4 digits between 0-9, in order to be accepted by NN4B. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patient.birthWeight</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component4/hl7:gestationAge/hl7:value[string-length(@value)=0]
			ANNOTATION This checks that the patient.gestationWeight value must be populated, <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patient.birthWeight</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component4/hl7:gestationAge/hl7:value/@value ^([0-4][0-9]|[0][0]|[9][9])$
			ANNOTATION <b>Purpose:</b><br/> This checks that the clinicalInformation.component4.gestationAge.value value must be 2 digits the first being between 1-4, inclusive of 4, the second digit should be between 0-9 inclusive of 9 and also including values 00 and 99. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>clinicalInformation.component4.gestationAge.value</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:subjectOf/hl7:primaryCareProvision/hl7:performer/hl7:primaryCareProvider/hl7:id[not(string-length(@extension)=6)]/@extension
			ANNOTATION This checks that the primaryCareProvider.id.extension must be populated, with a value which has a length of 6. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>primaryCareProvider.id.extension</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson[string-length(hl7:birthTime/@value)=8 or string-length(hl7:birthTime/@value)=12 or string-length(hl7:COCT_MT000210UK01.PartBirthTime/hl7:partPerson/hl7:birthTime/@value)=8 or string-length(hl7:COCT_MT000210UK01.PartBirthTime/hl7:partPerson/hl7:birthTime/@value)=12]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest BirthTime has a length of at least 8 and no more than 12. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.birthTime</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson[not(string-length(hl7:birthTime/@value)>=8)]/hl7:birthTime/@value
			ANNOTATION This checks that the PDSCreateInitialRecordRequest and the PdsBirthNotification patientMotherPerson.birthTime contains a value which has a length of 8 or more. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.birthTime</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[count(hl7:family)>1]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name does not have more than one family name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[count(hl7:given)>2]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name does not contain more than two given name. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name/child::hl7:family[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.family does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientMotherPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name/child::hl7:given[contains(.,'&amp;') or contains(.,'\') or contains(.,'^') or contains(.,'~') or contains(.,'|')]
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.given does not contain the following alpha characters: <br/> <ul> <li>Ampersand &amp; </li> <li>Backslash \</li> <li>Caret ^</li> <li>Tilde ~</li> <li>Vertical bar |</li> </ul> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request. and PdsBirthNotification. <ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:id/@extension [0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9][0-9]
			ANNOTATION This checks that within the mother nhs number contains 10 digits which are between 0-9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>mother.id</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[string-length(hl7:family)=0]/hl7:family
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.family contains a value. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:recordTarget/hl7:mother/hl7:patientMotherPerson/hl7:name[string-length(hl7:given[1])=0]/hl7:given[1]
			ANNOTATION This checks that the PDSCreateInitialRecordRequest patientMotherPerson.name.given contains a value. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientMotherPerson.name.given</li> </ul>
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:multipleBirthOrderNumber/@value ^([1-9])$
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.patientPerson.multipleBirthOrderNumber contains a value which is a single digit between 1-9 and inclusive of 9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.multipleBirthOrderNumber</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			IF hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value ^([1-6]|[9])$
			THEN
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient[hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value<6]/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value[@value < /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:multipleBirthOrderNumber/@value]/@value
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest.NumberOfFoetusConfinement value is more or equal to the patientPerson.multipleBirthOrderNumber. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.multipleBirthOrderNumber</li> <li>numberOfFoetusInConfinement</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient[hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value<6]/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value/@value
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:subjectOf2/hl7:clinicalInformation/hl7:component3/hl7:numberOfFoetusInConfinement/hl7:value[@value < /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:patientPerson/hl7:multipleBirthOrderNumber/@value]/@value
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest.NumberOfFoetusConfinement value is more or equal to the patientPerson.multipleBirthOrderNumber. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification.<ul><li>patientPerson.multipleBirthOrderNumber</li> <li>numberOfFoetusInConfinement</li> </ul>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(hl7:family)=0]/hl7:family
			ANNOTATION This checks that within the notifying person the name.family is populated. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[count(child::hl7:family)>1]/hl7:family
			ANNOTATION <b>Purpose:</b><br/> This checks that within the notifying person there is only one name.family present. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[count(child::hl7:given)>2]/hl7:given
			ANNOTATION This checks that within the notifying person no more than two name.given are present. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.given</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(hl7:given[1])=0 or string-length(hl7:given[2])>0]/hl7:given
			ANNOTATION 
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:author/hl7:notifier/hl7:assignedNotifierPerson/hl7:name[string-length(child::hl7:family)>35]/hl7:family
			ANNOTATION This checks that within the notifying person the name.family is no more than 35 characters in length. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>assignedNotifierPerson.name.family</li> </ul>
			CHECK hl7_xpathexists /*[1]//hl7:subject/hl7:patient[hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:locatedPlaceOfBirth/hl7:addr/hl7:country or hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*//hl7:locatedPlaceOfBirth/hl7:addr/hl7:city or hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*//hl7:locatedPlaceOfBirth/hl7:addr/hl7:county]/child::*
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.locatedPlaceOfBirth.addr contains the patient country,county or city. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>locatedPlaceOfBirth.addr</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:location/hl7:participantDeliveryLocation/hl7:code[@code=0 or @code=2 or @code=3 or @code=4 or @code=7]/@code
			ANNOTATION <b>Purpose:</b><br/> This checks that the PDSCreateInitialRecordRequest.participantDeliveryLocation.code does not contain the values 0 or 2, 3, 4 or 7. <br/> REF TO MIM 7.2.02 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>participantDeliveryLocation,code</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationEvent/hl7:subject/hl7:patient/hl7:babyOf/hl7:obstetricCareProvision/hl7:location/hl7:participantIdentifiedDeliveryLocation/hl7:code[@code=1 or @code=8 or @code=9]/@code
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.participantIdentifiedDeliveryLocation.code does not contain the values 1,8 or 9. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>participantIdentifiedDeliveryLocation,codee</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patient[not(string-length(hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:locatedPlaceOfBirth/hl7:name)>0) and not((hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:code/@code)='1')and not(hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:code/@code='8') and not(hl7:babyOf/hl7:obstetricCareProvision/hl7:location/child::*/hl7:code/@code='9') ]/hl7:code/@code
			ANNOTATION This checks that the PDSCreateInitialRecordRequest.locatedPlaceOfBirth.name exist if the participantIdentifiedDeliveryLocation exists. <br/> REF TO MIM 6.3 PDS Tabular view: PDS Create Initial Record Request and PdsBirthNotification. <ul><li>locatedPlaceOfBirth.name</li> <li>participantIdentifiedDeliveryLocation.code </li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole' or local-name()='patient']/hl7:telecom[@use]/*
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/telecom[not(@use='HP') and not(@use='H') and not(@use='MC') and not(@use='HV') and not(@use='WP') and not(@use='AS') and not(@use='EC') and not(@use='PG') and not(@use='MC')]/@use
				
			ANNOTATION To enforce the particular flavour of the Telecommunication Address (TEL) datatype used here is Telecommunication address plus use. <ul> For each telecommunication number, the use attribute to denote the type of telecommunication address must occur (mandatory). The use attribute can take the following values: <li>H - A communication address at a home;</li> <li>HP - The primary home, to reach a person after business hours;</li> <li>HV - A vacation home, to reach a person while on vacation; <li>WP - An office address;</li> <li>AS - An automated answering machine;</li> <li>EC - A contact specifically designated to be used for emergencies;</li> <li>PG - A paging device suitable to solicit a callback or to leave a very short message;</li> <li>MC - A telecommunication device that moves and stays with its owner.</li></li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-8</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN000203UK03
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Address_Validation.xslt Error
			ANNOTATION <b>Purpose:</b><br/> Address lines 1-5 MUST NOT exceed 35 characters <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <br/> <li>PDS Create Initial Record Request (Patient.addr)</li> <br/> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress . PartOfWhole.addr)</li> <br/> <li>PDS Birth Notification (Patient.addr/)</li> <br/> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-4.1</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[hl7:addr][local-name()='patientRole' or 'scopedRelatedPersonRole' or 'patient']/hl7:addr[@use='PST' and not(@updateMode='removed') and not(hl7:useablePeriod)]
			ANNOTATION <b>Purpose:</b><br/> Check the business effective dates associated with correspondence addresses MUST be recorded. <ul> <li>only applies to addresses with use ='PST'</li> <li>the useablePeriod must be present and populated.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS General Update Request - (PatientRole.addr/ RelatedPersonRole.addr)]</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03; UPDSPT-6.1.3</li> <li>(Note, this requirement is not described in the MIM or DIM)</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[contains(local-name(),'patientRole') or contains(local-name(),'patient')]/hl7:addr[@use='H'][@updateMode='added' or @updateMode='altered'][hl7:useablePeriod]/hl7:useablePeriod/@high
			ANNOTATION <b>Purpose:</b><br/> The following objects MUST NOT be assigned a business effective to date when added or altered on the PDS: Patient home address (use = H) <br/> <b>Applied to Messages:</b> <ul> <li>PDS General Update Request -(PatientRole.addr/ RelatedPersonRole.addr)])</li> <br/> <li>PDS NHAIS Update Request - (PatientRole.addr)] </li> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-2 (Note this is not stated in the MIM 6.2.02 or in the DIM Issue 7)</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr[hl7:useablePeriod]
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:low/@value]/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.low.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[@updateMode]/@updateMode
			THEN
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_GeneralUpdateValidation_AllInOne.xslt Error
			ANNOTATION An element with updateMode = 'altered' or 'removed' or 'added' need to meet certain constraints depending on the element and the state of it. This runs additional 76 rules and returns the summary fo errors. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1][hl7:ControlActEvent//hl7:person.deceasedTime/hl7:value/@value | hl7:ControlActEvent//hl7:subject//hl7:subject/hl7:patientRole//hl7:deceasedTime/@value]
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]//hl7:subject/hl7:patientRole//hl7:deceasedTime[string-length(@value)!=12 and string-length(@value)!=8 and /*[1]//hl7:deathNotification[@updateMode="added" or @updateMode="altered"]]
				
			ANNOTATION This checks that when a deceasedTime is added or altered it is in the form of YYYYMMDD with a length of 8 or 12. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDSEM-4
			CHECK hl7_xpathnotexists /*[1]//hl7:deceasedTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the deceasedTime is not in the future based on if its value is more than the message creation date <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3 deceasedTime is not in the future when compared to message creation date.
			CHECK hl7_xpathexists /*[1]//hl7:deathNotification[@updateMode=/*[1]//hl7:deceasedTime/@updateMode or @updateMode=/*[1]//hl7:COCT_MT000211UK01.PartDeceasedTime/@updateMode]/@updateMode
				
			ANNOTATION This checks that the deathNotification attribute updateMode is equal to deceasedTime attribute updateMode. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDSEM-4.2
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:scopedRelatedPersonRole//hl7:partNextOfKin/hl7:code[@code!='1']/@code
			ANNOTATION <b>Purpose:</b><br/> This checks that within the PDS Update the related person <ul> <li>next of kin element is present only when NOK code = 1 </li> </ul> <b>Applied to Messages:</b> <ul> <li> PDS General Update message(patientPerson.scopedRelatedPersonRole.partNextOfKin.code)]</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 4.2 PDS – tabular view constraint </li> </ul> <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole' or local-name()='patient']/hl7:telecom[@use]/*
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/telecom[not(@use='HP') and not(@use='H') and not(@use='MC') and not(@use='HV') and not(@use='WP') and not(@use='AS') and not(@use='EC') and not(@use='PG') and not(@use='MC')]/@use
				
			ANNOTATION To enforce the particular flavour of the Telecommunication Address (TEL) datatype used here is Telecommunication address plus use. <ul> For each telecommunication number, the use attribute to denote the type of telecommunication address must occur (mandatory). The use attribute can take the following values: <li>H - A communication address at a home;</li> <li>HP - The primary home, to reach a person after business hours;</li> <li>HV - A vacation home, to reach a person while on vacation; <li>WP - An office address;</li> <li>AS - An automated answering machine;</li> <li>EC - A contact specifically designated to be used for emergencies;</li> <li>PG - A paging device suitable to solicit a callback or to leave a very short message;</li> <li>MC - A telecommunication device that moves and stays with its owner.</li></li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-8</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/*
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole']/hl7:telecom/hl7:useablePeriod/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='patientRole' or local-name()='scopedRelatedPersonRole' or local-name()='patient']/hl7:telecom/hl7:useablePeriod/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION This is to enforce for the Telecommunication Address (TEL) datatype that: <ul> <li>If useablePeriod element is used it must be in the format YYYYMMDD.</li> </ul> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole. telecom)</li> <br/> <li>PDS General Update Request (PatientRole. telecom/ RelatedPersonRole. telecom)</li> <br/> <li>PDS Create Initial Record Request(Patient. telecom)</li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-1</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:subjectOf5/hl7:sharedSecret
			ANNOTATION This is to to check that the update does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:addr[not(@use='H')and not(@use='TMP') and not(@use='PST')]/@use
			ANNOTATION This checks that with a updated address that the following codes are used for the use attribute. H or TMP or PST. <br/> REF TO MIM 4.2 General update patient role address
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN000204UK03
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Address_Validation.xslt Error
			ANNOTATION <b>Purpose:</b><br/> Address lines 1-5 MUST NOT exceed 35 characters <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr/ RelatedPersonRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr)</li> <br/> <li>PDS Create Initial Record Request (Patient.addr)</li> <br/> <li>PDS Create Initial Record Request Rejected (Duplicate Found) -> R_PartAddress . PartOfWhole.addr)</li> <br/> <li>PDS Birth Notification (Patient.addr/)</li> <br/> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-4.1</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[contains(local-name(),'patientRole') or contains(local-name(),'patient')]/hl7:addr[@use='H'][@updateMode='added' or @updateMode='altered'][hl7:useablePeriod]/hl7:useablePeriod/@high
			ANNOTATION <b>Purpose:</b><br/> The following objects MUST NOT be assigned a business effective to date when added or altered on the PDS: Patient home address (use = H) <br/> <b>Applied to Messages:</b> <ul> <li>PDS General Update Request -(PatientRole.addr/ RelatedPersonRole.addr)])</li> <br/> <li>PDS NHAIS Update Request - (PatientRole.addr)] </li> </ul> <br/> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDDTS-2 (Note this is not stated in the MIM 6.2.02 or in the DIM Issue 7)</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='addr'][parent::hl7:patientRole or parent::hl7:scopedRelatedPersonRole][@use='H']
			ANNOTATION This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The use attribute denotes the type of address, where only the value "H" is permitted here (mandatory)</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDRPS-8.4</li> <li>From MIM 6.2.02, PDS – Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr[hl7:useablePeriod]
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:low/@value]/hl7:low/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.low.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/*[local-name()='patientRole']/hl7:addr/hl7:useablePeriod[hl7:high/@value]/hl7:high/@value ^([1-2][0-9]{3}((0[1-9]|1[012])(0[1-9]|1\d|2[0-8])|(0[13456789]|1[012])(29|30)|(0[13578]|1[02])31)|(([2-9]\d)(0[48]|[2468][048]|[13579][26])|(([2468][048]|[3579][26])00))0229)$
			ANNOTATION <b>Purpose:</b><br/> This is to enforce for the Postal Address (AD) datatype that: <ul> <li>The optional useablePeriod.high.value value date must be in the format YYYYMMDD.</li> </ul> <br/> <br/> <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request (PatientRole.addr)</li> <br/> <li>PDS General Update Request (PatientRole.addr)</li> <br/> <li>PDS NHAIS Update Request (PatientRole.addr) </li> </ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03: UPDSPT-6.1.3</li> <li>From MIM 6.2.02, PDS Version 4.3</li> </ul>
			ENDIF
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[@updateMode]/@updateMode
			THEN
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_GeneralUpdateValidation_AllInOne.xslt Error
			ANNOTATION An element with updateMode = 'altered' or 'removed' or 'added' need to meet certain constraints depending on the element and the state of it. This runs additional 76 rules and returns the summary fo errors. <br/>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:addr[not(@use='H')and not(@use='TMP') and not(@use='PST')]/@use
			ANNOTATION This checks that with a updated address that the following codes are used for the use attribute. H or TMP or PST. <br/> REF TO MIM 4.2 General update patient role address
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN010000UK32
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[@nullFlavor='NA']
			ANNOTATION This checks that within a simple Query the BirthTime does not contain null flavor. <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.deceasedTime
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[not(@value < /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.deceasedTime/hl7:value/@value)]/@value
			ANNOTATION This checks that within a simple Query the DeceasedTime does not precede the birthTime. <br/>
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.name/hl7:value[@use='L']/@use
			ANNOTATION This checks that the use attribute is present and has value L. <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address[not(hl7:person.address)]
			THEN
			ELSE
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[hl7:postalCode or hl7:addressKey]
			ANNOTATION <b>Purpose:</b><br/> This checks that within the parameter Person.address for either postcode or addressKey. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN020000UK31
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:searchParameter/hl7:value[@codeSystem='2.16.840.1.113883.2.1.3.2.4.17.39'][@code='1']
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:family,'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:family,"*"))>= 2)]/hl7:person.name/hl7:value/hl7:family
			ANNOTATION This checks that within advanced trace when the Patient Name or Family Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:given[1],'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:given[1],"*"))>= 2)]/hl7:person.name/hl7:value/hl7:given[1]
			ANNOTATION This checks that within advanced trace when the First Patient Given Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:given[2],'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:given[2],"*"))>= 2)]/hl7:person.name/hl7:value/hl7:given[2]
			ANNOTATION This checks that within advanced trace when the Second Patient Given Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[contains(hl7:postalCode,'*')and not(string-length(substring-before(hl7:postalCode,"*"))>= 2)]/hl7:postalCode
			ANNOTATION This checks that within advanced trace when the PostCode search uses a wildcard it is preceded by two characters. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[string-length(hl7:low/@value)>8 or string-length(hl7:high/@value)>8 or string-length(hl7:center/@value)>8]//@value
			ANNOTATION This checks that there are no HH hours MM Minutes and SS Seconds provided along with a Date. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-9.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[hl7:center/@value and hl7:low/@value or hl7:high/@value and hl7:center/@value or  hl7:high/@value and not(hl7:low/@value) or hl7:low/@value and not(hl7:high/@value)]/*
			ANNOTATION This checks that there is either a high and low sub element of BirthTime or center. <br/> MIM 3.1.11 and 4.2.00 Datatypes Interval (IVL) Time stamp (TS)
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id
			ANNOTATION This checks that within the Advance Trace the parameter Person.ID is not present. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-2
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.name/hl7:value[not(@use='L'or @use='A' or @use='PREFERRED' or @use='PREVIOUS-BIRTH' or @use='PREVIOUS' or @use='PREVIOUS-MAIDEN' or @use='PREVIOUS-BACHELOR' or @use='PREVIOUS')]/@use
			ANNOTATION This checks that the name's attribute use contains on of: "L","A",""PREFERRED","PREVIOUS-BIRTH","PREVIOUS-MAIDEN","PREVIOUS-BACHELOR","PREVIOUS". <br/> User defined
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN040000UK32
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id/hl7:value[@root='2.16.840.1.113883.2.1.4.1' or @root='2.16.840.1.113883.2.1.3.2.4.3']/@root
			ANNOTATION This checks that within the Retrieval Query the parameter Person.ID OID is either "2.16.840.1.113883.2.1.4.1" or "2.16.840.1.113883.2.1.3.2.4.3". <br/>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id/hl7:value[@root='2.16.840.1.113883.2.1.4.1' and string-length(@extension)=10 or @root='2.16.840.1.113883.2.1.3.2.4.3']/@extension
			ANNOTATION This checks that within the Retrieval Query if the parameter Person.ID OID is "2.16.840.1.113883.2.1.4.1" the attribute extension contains a value with 10 digits or 2.16.840.1.113883.2.1.3.2.4.3 with the corresponding Temporary NHS number issued by an NHAIS registration authority or the old NHS number itself. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDVLD-1.1
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN040000UK30
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationRequest/hl7:subject/hl7:patientRole/hl7:subjectOf4/hl7:sharedSecret
			ANNOTATION This is to to check that the allocation does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[@use='L']/@use
			THEN
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[not(count(hl7:family)=1)]
			ANNOTATION This checks that within PDS Allocate NHS Number Request a single instance of the family element is used to carry the family name (or surname); <br/> REF TO MIM 3.1.07 onwards: Tabular View Person.name
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[not(count(hl7:given)>0)]
			ANNOTATION This checks that within PDS Allocate NHS Number Request One or more instances of the given element are used to carry given names (or forenames) or initials. <br/> REF TO MIM 3.1.07 onwards: Tabular View Person.name
			ENDIF
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='addr'][parent::hl7:patientRole][@use='H' or @use='TMP']
			ANNOTATION <b>Purpose:</b><br/> This checks that as a minimum, the PDS NHS Number Allocation Request message MUST contain the following mandatory field: A current UK address of type H or TMP <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request - (PatientRole.addr)</li> <br/><li> </li></ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03 UPDALT-9</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN160000UK30
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[@updateMode]/@updateMode
			THEN
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_GeneralUpdateValidation_AllInOne.xslt Error
			ANNOTATION An element with updateMode = 'altered' or 'removed' or 'added' need to meet certain constraints depending on the element and the state of it. This runs additional 76 rules and returns the summary fo errors. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1][hl7:ControlActEvent//hl7:person.deceasedTime/hl7:value/@value | hl7:ControlActEvent//hl7:subject//hl7:subject/hl7:patientRole//hl7:deceasedTime/@value]
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]//hl7:subject/hl7:patientRole//hl7:deceasedTime[string-length(@value)!=12 and string-length(@value)!=8 and /*[1]//hl7:deathNotification[@updateMode="added" or @updateMode="altered"]]
				
			ANNOTATION This checks that when a deceasedTime is added or altered it is in the form of YYYYMMDD with a length of 8 or 12. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDSEM-4
			CHECK hl7_xpathnotexists /*[1]//hl7:deceasedTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the deceasedTime is not in the future based on if its value is more than the message creation date <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3 deceasedTime is not in the future when compared to message creation date.
			CHECK hl7_xpathexists /*[1]//hl7:deathNotification[@updateMode=/*[1]//hl7:deceasedTime/@updateMode or @updateMode=/*[1]//hl7:COCT_MT000211UK01.PartDeceasedTime/@updateMode]/@updateMode
				
			ANNOTATION This checks that the deathNotification attribute updateMode is equal to deceasedTime attribute updateMode. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDSEM-4.2
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:scopedRelatedPersonRole//hl7:partNextOfKin/hl7:code[@code!='1']/@code
			ANNOTATION <b>Purpose:</b><br/> This checks that within the PDS Update the related person <ul> <li>next of kin element is present only when NOK code = 1 </li> </ul> <b>Applied to Messages:</b> <ul> <li> PDS General Update message(patientPerson.scopedRelatedPersonRole.partNextOfKin.code)]</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 4.2 PDS – tabular view constraint </li> </ul> <br/>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:subjectOf5/hl7:sharedSecret
			ANNOTATION This is to to check that the update does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:addr[not(@use='H')and not(@use='TMP') and not(@use='PST')]/@use
			ANNOTATION This checks that with a updated address that the following codes are used for the use attribute. H or TMP or PST. <br/> REF TO MIM 4.2 General update patient role address
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN010000UK13
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[@nullFlavor='NA']
			ANNOTATION This checks that within a simple Query the BirthTime does not contain null flavor. <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.deceasedTime
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[not(@value < /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.deceasedTime/hl7:value/@value)]/@value
			ANNOTATION This checks that within a simple Query the DeceasedTime does not precede the birthTime. <br/>
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.name/hl7:value[@use='L']/@use
			ANNOTATION This checks that the use attribute is present and has value L. <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address[not(hl7:person.address)]
			THEN
			ELSE
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[hl7:postalCode or hl7:addressKey]
			ANNOTATION <b>Purpose:</b><br/> This checks that within the parameter Person.address for either postcode or addressKey. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN020000UK14
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:searchParameter/hl7:value[@codeSystem='2.16.840.1.113883.2.1.3.2.4.17.39'][@code='1']
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:family,'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:family,"*"))>= 2)]/hl7:person.name/hl7:value/hl7:family
			ANNOTATION This checks that within advanced trace when the Patient Name or Family Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:given[1],'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:given[1],"*"))>= 2)]/hl7:person.name/hl7:value/hl7:given[1]
			ANNOTATION This checks that within advanced trace when the First Patient Given Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query[hl7:searchParameter/hl7:value/@code='1'][contains(hl7:person.name/hl7:value/hl7:given[2],'*')and not(string-length(substring-before(hl7:person.name/hl7:value/hl7:given[2],"*"))>= 2)]/hl7:person.name/hl7:value/hl7:given[2]
			ANNOTATION This checks that within advanced trace when the Second Patient Given Name search uses a wildcard it is preceded by at least two characters. This only applies when it s alphanumeric. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[contains(hl7:postalCode,'*')and not(string-length(substring-before(hl7:postalCode,"*"))>= 2)]/hl7:postalCode
			ANNOTATION This checks that within advanced trace when the PostCode search uses a wildcard it is preceded by two characters. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-5.1
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[string-length(hl7:low/@value)>8 or string-length(hl7:high/@value)>8 or string-length(hl7:center/@value)>8]//@value
			ANNOTATION This checks that there are no HH hours MM Minutes and SS Seconds provided along with a Date. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-9.1
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.birthTime/hl7:value[hl7:center/@value and hl7:low/@value or hl7:high/@value and hl7:center/@value or  hl7:high/@value and not(hl7:low/@value) or hl7:low/@value and not(hl7:high/@value)]/*
			ANNOTATION This checks that there is either a high and low sub element of BirthTime or center. <br/> MIM 3.1.11 and 4.2.00 Datatypes Interval (IVL) Time stamp (TS)
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id
			ANNOTATION This checks that within the Advance Trace the parameter Person.ID is not present. <br/> REF TO NPFIT-FNT-TO-DPM-0610.03: TRCPDS-2
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE QUPA_IN040000UK14
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id/hl7:value[@root='2.16.840.1.113883.2.1.4.1' or @root='2.16.840.1.113883.2.1.3.2.4.3']/@root
			ANNOTATION This checks that within the Retrieval Query the parameter Person.ID OID is either "2.16.840.1.113883.2.1.4.1" or "2.16.840.1.113883.2.1.3.2.4.3". <br/>
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.id/hl7:value[@root='2.16.840.1.113883.2.1.4.1' and string-length(@extension)=10 or @root='2.16.840.1.113883.2.1.3.2.4.3']/@extension
			ANNOTATION This checks that within the Retrieval Query if the parameter Person.ID OID is "2.16.840.1.113883.2.1.4.1" the attribute extension contains a value with 10 digits or 2.16.840.1.113883.2.1.3.2.4.3 with the corresponding Temporary NHS number issued by an NHAIS registration authority or the old NHS number itself. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDVLD-1.1
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN040000UK15
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsRegistrationRequest/hl7:subject/hl7:patientRole/hl7:subjectOf4/hl7:sharedSecret
			ANNOTATION This is to to check that the allocation does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_Name_Validation.xslt error
			ANNOTATION <b>Purpose:</b><br/> This checks for any errors within the name elements including: <br/> <ul> <li>that the family element is populated</li> <li>that the name sub element family, suffix,prefix and 1st given name values do not exceed 35 characters</li> <li>that any name sub element 2nd given name value does not exceed 100 characters does not contain multiple spaces</li> </ul> <b>Applied to Messages:</b> <ul> <li>All Messages</li> <br/> </ul> <b>Requirement Reference:</b> <ul> <li>MIM 6.2</li> </ul>
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[@use='L']/@use
			THEN
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[not(count(hl7:family)=1)]
			ANNOTATION This checks that within PDS Allocate NHS Number Request a single instance of the family element is used to carry the family name (or surname); <br/> REF TO MIM 3.1.07 onwards: Tabular View Person.name
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:name[not(count(hl7:given)>0)]
			ANNOTATION This checks that within PDS Allocate NHS Number Request One or more instances of the given element are used to carry given names (or forenames) or initials. <br/> REF TO MIM 3.1.07 onwards: Tabular View Person.name
			ENDIF
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[local-name()='addr'][parent::hl7:patientRole][@use='H' or @use='TMP']
			ANNOTATION <b>Purpose:</b><br/> This checks that as a minimum, the PDS NHS Number Allocation Request message MUST contain the following mandatory field: A current UK address of type H or TMP <b>Applied to Messages:</b> <ul> <li>PDS NHS Number Allocation Request - (PatientRole.addr)</li> <br/><li> </li></ul> <b>Requirement Reference:</b> <ul> <li>NPFIT-FNT-TO-DPM-0649.03 UPDALT-9</li> <li>From MIM 6.2.02, PDS –Version 4.3</li> </ul>
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN100000UK14
			IF hl7_xpathnotexists /*[1][hl7:ControlActEvent//hl7:person.deceasedTime/hl7:value/@value | hl7:ControlActEvent//hl7:subject//hl7:subject/hl7:patientRole//hl7:deceasedTime/@value]
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]//hl7:subject/hl7:patientRole//hl7:deceasedTime[string-length(@value)!=12 and string-length(@value)!=8 and /*[1]//hl7:deathNotification[@updateMode="added" or @updateMode="altered"]]
				
			ANNOTATION This checks that when a deceasedTime is added or altered it is in the form of YYYYMMDD with a length of 8 or 12. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDSEM-4
			CHECK hl7_xpathnotexists /*[1]//hl7:deceasedTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the deceasedTime is not in the future based on if its value is more than the message creation date <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3 deceasedTime is not in the future when compared to message creation date.
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:subjectOf/hl7:deathNotification/hl7:value[@code='2']/@code
			ANNOTATION This checks that within PDS Death Update Started interaction deathNotification value does not have contain "2" which represents (Formal) death notice received from Registrar of Deaths <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDDTH-1.1
			ENDIF
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN120000UK14
			CHECK hl7_xpathexists /*[1]/hl7:ControlActEvent//hl7:subject/hl7:patientRole/hl7:subjectOf/hl7:consent/hl7:code[@code='4' and @codeSystem='2.16.840.1.113883.2.1.3.2.4.17.35' or @codeSystem='2.16.840.1.113883.2.1.3.2.4.16.2']
			ANNOTATION This checks that the Consent Update code contains the code 4 with the codesystem "2.16.840.1.113883.2.1.3.2.4.17.35" or 2.16.840.1.113883.2.1.3.2.4.16.2 <br/>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent//hl7:subject/hl7:patientRole/hl7:subjectOf/hl7:consent/hl7:pertinentInformation[not(hl7:pertinentInformation/hl7:pertinentSupplementaryComments)]
			ANNOTATION This checks that the Consent Update does not contain the SupplementaryComments element. <br/> REF NPFIT-FNT-TO-DPM-0612.02 / UPDCST-2.1
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN110000UK15
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[@updateMode]/@updateMode
			THEN
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_GeneralUpdateValidation_AllInOne.xslt Error
			ANNOTATION An element with updateMode = 'altered' or 'removed' or 'added' need to meet certain constraints depending on the element and the state of it. This runs additional 76 rules and returns the summary fo errors. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:patientRole/hl7:patientPerson/hl7:multipleBirthOrderNumber[@updateMode='added' or @updateMode='altered']/@value
			THEN
			ELSE
			CHECK hl7_xpathmatches /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:patientPerson/hl7:multipleBirthOrderNumber[@updateMode='added' or @updateMode='altered']/@value ^[1-9]$
			ANNOTATION This checks that within the General Update the Patient Multiple Birth Order Number contains a single digit which is between 1-9. <br/>
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:patientPerson[count(child::hl7:name[@use='L'])>1]
			ANNOTATION This checks that there is not multiple occurrances of the name with type 'L'. <br/>
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:subjectOf1/hl7:consent
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:patientRole/hl7:subjectOf1/hl7:consent/hl7:code[not(@code='6')]
			ANNOTATION This checks the Consent code is 6 and the codeSystem is equal to 2.16.840.1.113883.2.1.3.2.4.17.35.
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:subjectOf5/hl7:sharedSecret
			ANNOTATION This is to to check that the update does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:addr[not(@use='H')and not(@use='TMP') and not(@use='PST')]/@use
			ANNOTATION This checks that with a updated address that the following codes are used for the use attribute. H or TMP or PST. <br/> REF TO MIM 4.2 General update patient role address
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule

			VALIDATE PRPA_IN160000UK01
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole//hl7:birthTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the Birthdate is not in the future based in if its value is more than the message creation date. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3
			IF hl7_xpathexists /*[1]/hl7:ControlActEvent/hl7:subject//*[@updateMode]/@updateMode
			THEN
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/PDS_GeneralUpdateValidation_AllInOne.xslt Error
			ANNOTATION An element with updateMode = 'altered' or 'removed' or 'added' need to meet certain constraints depending on the element and the state of it. This runs additional 76 rules and returns the summary fo errors. <br/>
			ENDIF
			IF hl7_xpathnotexists /*[1][hl7:ControlActEvent//hl7:person.deceasedTime/hl7:value/@value | hl7:ControlActEvent//hl7:subject//hl7:subject/hl7:patientRole//hl7:deceasedTime/@value]
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]//hl7:subject/hl7:patientRole//hl7:deceasedTime[string-length(@value)!=12 and string-length(@value)!=8 and /*[1]//hl7:deathNotification[@updateMode="added" or @updateMode="altered"]]
				
			ANNOTATION This checks that when a deceasedTime is added or altered it is in the form of YYYYMMDD with a length of 8 or 12. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDSEM-4
			CHECK hl7_xpathexists /*[1]//hl7:deathNotification[@updateMode=/*[1]//hl7:deceasedTime/@updateMode or @updateMode=/*[1]//hl7:COCT_MT000211UK01.PartDeceasedTime/@updateMode]/@updateMode
				
			ANNOTATION This checks that the deathNotification attribute updateMode is equal to deceasedTime attribute updateMode. <br/> REF TO NPFIT-FNT-TO-DPM-0612.02 / UPDSEM-4.2
			CHECK hl7_xpathnotexists /*[1]//hl7:deceasedTime[substring(@value,1,8) > substring(/*[1]/hl7:creationTime/@value,1,8)]/@value
			ANNOTATION This checks that the deceasedTime is not in the future based on if its value is more than the message creation date <br/> REF TO NPFIT-FNT-TO-DPM-0612.02: UPDVLD-1.3 deceasedTime is not in the future when compared to message creation date.
			ENDIF
			IF hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,'*'))]/hl7:postalCode
			THEN
			ELSE
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:query/hl7:person.address/hl7:value[not(contains(hl7:postalCode,' '))]/hl7:postalCode
			ANNOTATION This checks the postcode is in the PAF standard which includes: <ul> <li>a space between the outcode and incode </li> </ul> <br/> REF TO NPFIT-FNT-TO-DPM-0610.03:TRCPDS-7
			ENDIF
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject/hl7:PdsUpdateRequest/hl7:subject/hl7:patientRole/hl7:subjectOf5/hl7:sharedSecret
			ANNOTATION This is to to check that the update does not contain the sharedSecret element: <b>Requirement Reference:</b> <ul> <li>Requirement specified by PDS Team</li> </ul>
			CHECK hl7_xpathnotexists /*[1]/hl7:ControlActEvent/hl7:subject//hl7:subject/hl7:patientRole/hl7:addr[not(@use='H')and not(@use='TMP') and not(@use='PST')]/@use
			ANNOTATION This checks that with a updated address that the following codes are used for the use attribute. H or TMP or PST. <br/> REF TO MIM 4.2 General update patient role address
			CHECK hl7_xslt /home/riro/TKW-5.0.5/TKW/config/SPINE_PDS_Validation/validator_config/transforms/ActRefChecker.xslt /Parser/Reason[@Type='Error']
			ANNOTATION This checks the structure of the act ref particulary: <ul><li>that the classCode of the actref is the same as the original act </li> <li>that the moodCode is the same as the original act </li> </ul> <br/> Generic Rule
			
